% Book of Verse - LaTeX Template for Premium Print
% Designed for high-quality custom printing
\documentclass[11pt,openright,twoside]{book}

%% ============================================================
%% PAGE GEOMETRY - 7" x 10" Technical Book Format
%% ============================================================
\usepackage[
    paperwidth=7in,
    paperheight=10in,
    inner=0.875in,      % Binding side - generous for perfect binding
    outer=0.75in,
    top=0.875in,
    bottom=1in,
    headheight=14pt,
    headsep=0.25in,
    footskip=0.4in
]{geometry}

%% ============================================================
%% FONTS - Professional Typography
%% ============================================================
\usepackage{fontspec}
\usepackage{unicode-math}

% Font directory for locally installed fonts
\newcommand{\userfontpath}{C:/Users/marcu/AppData/Local/Microsoft/Windows/Fonts/}

% Main text font - Source Serif for readability
\IfFontExistsTF{Source Serif 4}{
    \setmainfont{Source Serif 4}[
        UprightFont = *-Regular,
        BoldFont = *-Bold,
        ItalicFont = *-Italic,
        BoldItalicFont = *-BoldItalic,
        Scale = 1.0
    ]
}{
    \setmainfont{SourceSerif4-Regular.otf}[
        Path=\userfontpath,
        BoldFont=SourceSerif4-Bold.otf,
        ItalicFont=SourceSerif4-It.otf,
        BoldItalicFont=SourceSerif4-BoldIt.otf,
        Scale = 1.0
    ]
}

% Sans-serif for headings
\IfFontExistsTF{Source Sans 3}{
    \setsansfont{Source Sans 3}[
        UprightFont = *-Regular,
        BoldFont = *-Bold,
        ItalicFont = *-Italic,
        BoldItalicFont = *-BoldItalic,
        Scale = 0.95
    ]
}{
    \setsansfont{SourceSans3-Regular.otf}[
        Path=\userfontpath,
        BoldFont=SourceSans3-Bold.otf,
        ItalicFont=SourceSans3-It.otf,
        BoldItalicFont=SourceSans3-BoldIt.otf,
        Scale = 0.95
    ]
}

% Monospace for code - JetBrains Mono with ligatures
\IfFontExistsTF{JetBrains Mono}{
    \setmonofont{JetBrains Mono}[
        UprightFont = *-Regular,
        BoldFont = *-Bold,
        ItalicFont = *-Italic,
        Scale = 0.85
    ]
}{
    \setmonofont{JetBrainsMono-Regular.ttf}[
        Path=\userfontpath,
        BoldFont=JetBrainsMono-Bold.ttf,
        ItalicFont=JetBrainsMono-Italic.ttf,
        BoldItalicFont=JetBrainsMono-BoldItalic.ttf,
        Scale = 0.85
    ]
}

%% ============================================================
%% COLORS
%% ============================================================
\usepackage{xcolor}

% Brand colors (based on Verse/Epic aesthetic)
\definecolor{verseblue}{RGB}{30, 90, 160}
\definecolor{verseorange}{RGB}{255, 87, 34}
\definecolor{versegray}{RGB}{60, 60, 65}
\definecolor{codebg}{RGB}{248, 248, 248}
\definecolor{warningbg}{RGB}{255, 243, 224}
\definecolor{warningborder}{RGB}{255, 152, 0}
\definecolor{notebg}{RGB}{227, 242, 253}
\definecolor{noteborder}{RGB}{33, 150, 243}
\definecolor{tipbg}{RGB}{232, 245, 233}
\definecolor{tipborder}{RGB}{76, 175, 80}
\definecolor{dangerbg}{RGB}{255, 235, 238}
\definecolor{dangerborder}{RGB}{244, 67, 54}

%% ============================================================
%% HEADERS AND FOOTERS
%% ============================================================
\usepackage{fancyhdr}
\usepackage{titlesec}

\pagestyle{fancy}
\fancyhf{}

% Headers
\fancyhead[LE]{\small\textit{\nouppercase{\leftmark}}}
\fancyhead[RO]{\small\textit{\nouppercase{\rightmark}}}

% Page numbers
\fancyfoot[LE,RO]{\thepage}

% Chapter pages - plain style
\fancypagestyle{plain}{
    \fancyhf{}
    \fancyfoot[C]{\thepage}
    \renewcommand{\headrulewidth}{0pt}
}

\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0pt}

%% ============================================================
%% CHAPTER AND SECTION STYLING
%% ============================================================
\titleformat{\part}[display]
    {\centering\Huge\bfseries\sffamily\color{versegray}}
    {\partname\ \thepart}
    {20pt}
    {\Huge}

\titleformat{\chapter}[display]
    {\normalfont\huge\bfseries\sffamily\color{versegray}}
    {\chaptertitlename\ \thechapter}
    {20pt}
    {\Huge}

\titleformat{\section}
    {\normalfont\Large\bfseries\sffamily\color{versegray}}
    {\thesection}
    {1em}
    {}

\titleformat{\subsection}
    {\normalfont\large\bfseries\sffamily\color{versegray}}
    {\thesubsection}
    {1em}
    {}

\titleformat{\subsubsection}
    {\normalfont\normalsize\bfseries\sffamily}
    {\thesubsubsection}
    {1em}
    {}

%% ============================================================
%% CODE LISTINGS
%% ============================================================
\usepackage{listings}
\usepackage{tcolorbox}
\tcbuselibrary{listings,skins,breakable}

% Verse language definition
\lstdefinelanguage{verse}{
    keywords={if, then, else, for, loop, case, return, break, defer, block, spawn, sync, race, rush, branch, set, var, module, using, where, class, struct, enum, interface, extends, implements, constructor, override, abstract, final, public, private, protected, internal, native, import, export, true, false, not, and, or, in, of, type, Self},
    keywordstyle=\color{verseblue}\bfseries,
    ndkeywords={int, float, string, logic, char, void, any, tuple, array, map, option, weak_map, rational, comparable, subtype, type, false},
    ndkeywordstyle=\color{verseorange}\bfseries,
    sensitive=true,
    comment=[l]{\#},
    commentstyle=\color{gray}\itshape,
    stringstyle=\color{teal},
    string=[b]",
    morestring=[b]',
    showstringspaces=false,
    basicstyle=\ttfamily\small,
    breaklines=true,
    breakatwhitespace=true,
    tabsize=4,
    frame=none,
    backgroundcolor=\color{codebg},
    xleftmargin=0.5em,
    xrightmargin=0.5em,
}

\lstset{
    language=verse,
    basicstyle=\ttfamily\small,
    numbers=left,
    numberstyle=\tiny\color{gray},
    numbersep=8pt,
    breaklines=true,
    showstringspaces=false,
    tabsize=4,
}

% Code block environment with background
\newtcblisting{versecode}{
    listing only,
    listing options={language=verse},
    colback=codebg,
    colframe=codebg,
    arc=2pt,
    boxrule=0.5pt,
    left=4pt,
    right=4pt,
    top=4pt,
    bottom=4pt,
    breakable,
    enhanced jigsaw,
}

%% ============================================================
%% ADMONITION BOXES
%% ============================================================
\newtcolorbox{warningbox}{
    colback=warningbg,
    colframe=warningborder,
    boxrule=0pt,
    leftrule=4pt,
    arc=0pt,
    outer arc=0pt,
    left=8pt,
    right=8pt,
    top=8pt,
    bottom=8pt,
    breakable,
}

\newtcolorbox{notebox}{
    colback=notebg,
    colframe=noteborder,
    boxrule=0pt,
    leftrule=4pt,
    arc=0pt,
    outer arc=0pt,
    left=8pt,
    right=8pt,
    top=8pt,
    bottom=8pt,
    breakable,
}

\newtcolorbox{tipbox}{
    colback=tipbg,
    colframe=tipborder,
    boxrule=0pt,
    leftrule=4pt,
    arc=0pt,
    outer arc=0pt,
    left=8pt,
    right=8pt,
    top=8pt,
    bottom=8pt,
    breakable,
}

\newtcolorbox{dangerbox}{
    colback=dangerbg,
    colframe=dangerborder,
    boxrule=0pt,
    leftrule=4pt,
    arc=0pt,
    outer arc=0pt,
    left=8pt,
    right=8pt,
    top=8pt,
    bottom=8pt,
    breakable,
}

\newtcolorbox{infobox}{
    colback=notebg,
    colframe=noteborder,
    boxrule=0pt,
    leftrule=4pt,
    arc=0pt,
    outer arc=0pt,
    left=8pt,
    right=8pt,
    top=8pt,
    bottom=8pt,
    breakable,
}

%% ============================================================
%% TABLES
%% ============================================================
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{tabu}

% Alternating row colors for tables
\usepackage{colortbl}
\definecolor{tablerowgray}{RGB}{245, 245, 245}

%% ============================================================
%% HYPERLINKS (for PDF navigation, not print)
%% ============================================================
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=verseblue,
    urlcolor=verseblue,
    citecolor=verseblue,
    pdftitle={Book of Verse},
    pdfauthor={Epic Games / Tim Sweeney},
    bookmarksnumbered=true,
    bookmarksopen=true,
}

%% ============================================================
%% MISCELLANEOUS
%% ============================================================
\usepackage{graphicx}
\usepackage{float}
\usepackage{enumitem}
\usepackage{microtype}  % Better typography
\usepackage{parskip}    % Space between paragraphs instead of indent

% Reduce widow and orphan lines
\widowpenalty=10000
\clubpenalty=10000

% Better list spacing
\setlist{noitemsep, topsep=0.5em}

%% ============================================================
%% PANDOC COMPATIBILITY
%% ============================================================
% These definitions help Pandoc output work correctly
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% Support for fenced divs (used for admonitions)
\newenvironment{Shaded}{\begin{tcolorbox}[colback=codebg,colframe=codebg,arc=2pt,boxrule=0pt]}{\end{tcolorbox}}
\newcommand{\KeywordTok}[1]{\textcolor{verseblue}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor{verseorange}{\textbf{#1}}}
\newcommand{\CommentTok}[1]{\textcolor{gray}{\textit{#1}}}
\newcommand{\StringTok}[1]{\textcolor{teal}{#1}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{#1}

$if(highlighting-macros)$
$highlighting-macros$
$endif$

% Enable line breaking for long code lines that exceed the text width
\usepackage{fvextra}
\fvset{breaklines=true, breakanywhere=true, breaksymbolright=\small\ensuremath{\hookrightarrow}}

%% ============================================================
%% DOCUMENT
%% ============================================================
\begin{document}

%% ------------------------------------------------------------
%% FRONT MATTER
%% ------------------------------------------------------------
\frontmatter

% Half title page
\begin{titlepage}
\centering
\vspace*{3in}
{\Huge\sffamily\bfseries Book of Verse}
\vfill
\end{titlepage}

\cleardoublepage

% Full title page
\begin{titlepage}
\centering
\vspace*{1.5in}

{\Huge\sffamily\bfseries\color{versegray} Book of Verse}

\vspace{0.5in}

{\Large\itshape The Verse Programming Language by Tim Sweeney}

\vspace{1in}

{\large Documentation by the Verse Team --- Epic Games}

\vfill
\end{titlepage}

\cleardoublepage

% Copyright page
\thispagestyle{empty}
\vspace*{\fill}
\begin{center}
\textbf{Book of Verse}\\[1em]
Documentation for the Verse Programming Language\\[2em]

Copyright \textcopyright\ Epic Games, Inc.\\[1em]

Licensed under CC0-1.0 (Public Domain)\\[1em]

This documentation is provided ``as is'' without warranty of any kind.\\
Verse is a trademark of Epic Games, Inc.\\[2em]

Source: \url{https://github.com/verselang/book}\\[1em]

\textit{Printed Edition}
\end{center}
\vfill
\cleardoublepage

% Table of Contents
\tableofcontents
\cleardoublepage

%% ------------------------------------------------------------
%% MAIN MATTER
%% ------------------------------------------------------------
\mainmatter

$body$

%% ------------------------------------------------------------
%% BACK MATTER
%% ------------------------------------------------------------
\backmatter

% Colophon
\cleardoublepage
\thispagestyle{empty}
\vspace*{\fill}
\begin{center}
\textsc{Colophon}\\[2em]

This book was typeset using \LaTeX{} with XeLaTeX.\\[1em]

Body text is set in Source Serif 4.\\
Headings are set in Source Sans 3.\\
Code samples are set in JetBrains Mono.\\[1em]

Page size: 7\textquotedbl\ $\times$ 10\textquotedbl\\
Printed on 60 lb natural paper.\\[2em]

\textit{Generated with Pandoc and custom preprocessing}
\end{center}
\vfill

\end{document}
